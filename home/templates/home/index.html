{% extends 'base.html' %}
{% load static %}

{% block title %}Home | EventScout{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
{% endblock %}

{% block content %}
    <div id="map"></div>

    <script>
        const events = [
            {
                "name": "Event 1",
                "location": "Location 1",
                "date": "2023-10-01",
                "time": "10:00 AM",
                "description": "Description for Event 1",
                "coordinates": {
                    "latitude": 40.7128,
                    "longitude": 74.0060
                }
            },
            {
                "name": "Event 2",
                "location": "Location 2",
                "date": "2023-10-02",
                "time": "11:00 AM",
                "description": "Description for Event 2",
                "coordinates": {
                    "latitude": 34.0522,
                    "longitude": 118.2437
                }
            },
            {
                "name": "Event 3",
                "location": "Location 3",
                "date": "2023-10-03",
                "time": "12:00 PM",
                "description": "Description for Event 3",
                "coordinates": {
                    "latitude": 51.5074,
                    "longitude": 0.1278
                }
            }
        ];

        function addEventMarkers(map) {
            for (const event of events) {
                const marker = new google.maps.Marker({
                    position: {
                        lat: event.coordinates.latitude,
                        lng: event.coordinates.longitude
                    },
                    map: map,
                    title: event.name
                });

                const contentString = `
                    <div>
                        <h5>${event.name}</h5>
                        <p><strong>Location:</strong> ${event.location}</p>
                        <p><strong>Date:</strong> ${event.date}</p>
                        <p><strong>Time:</strong> ${event.time}</p>
                        <p>${event.description}</p>
                        <a href="/createEvents/rsvp/${event.id}/" class="btn btn-primary btn-sm mt-2">RSVP</a>
                    </div>
                `;

                const infoWindow = new google.maps.InfoWindow({
                    content: contentString
                });

                marker.addListener("click", () => {
                    infoWindow.open(map, marker);
                });
            }
        }

        function loadMap(centerLocation, initialTitle) {
            const map = new google.maps.Map(document.getElementById('map'), {
                center: centerLocation,
                zoom: 13,
                disableDefaultUI: true,
                styles: [
                    { featureType: "poi", stylers: [{ visibility: "off" }] },
                    { featureType: "transit", stylers: [{ visibility: "off" }] },
                    { featureType: "road", elementType: "labels.icon", stylers: [{ visibility: "off" }] }
                ]
            });

            new google.maps.Marker({
                position: centerLocation,
                map: map,
                title: initialTitle
            });

            addEventMarkers(map);
        }

        function initMap() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        loadMap(userLocation, "You are here");
                    },
                    function () {
                        loadMap({ lat: 33.7756, lng: -84.3963 }, "Default Location");
                    }
                );
            } else {
                loadMap({ lat: 33.7756, lng: -84.3963 }, "Default Location");
            }
        }

        window.onload = initMap;
    </script>

{% endblock %}